$(function() {
	! function(e, n, i) {
		var a;
		if($(window).width() <= 700){
			a = Math.min($(window).width() / n, $(window).height() / i);
		}else{
			a = Math.max($(window).width() / n, $(window).height() / i);
		}
		$(e).width(a * n).height(a * i)
	}(".slideMain", 640, 960);


	/*音乐播放*/
	var a = function(e) {
		var n = new Audio,
			i = !1;
		for (var a in e) e.hasOwnProperty(a) && a in n && (n[a] = e[a]);
		return {
			play: function() {
				i = !0, n.play()
			},
			pause: function() {
				i = !1, n.pause()
			},
			toggle: function() {
				return i ? this.pause() : this.play(), i
			}
		}
	}({
		loop: !0,
		preload: "auto",
		src: "/anniversary/music/birthor.mp3"
	});

	$(document).one("touchstart", function(e) {
		"music" == $(e.target).attr("id") ? $("#music").removeClass("on") : a.play(), event.preventDefault()
	}), $(document).on("touchstart", function() {
		$(".layer_share").removeClass("showShare")
	}), $(".btnShare").click(function() {
		$(".layer_share").addClass("showShare")
	}), $("#music").addClass("on").on("click", function() {
		$(this).hasClass("on") ? a.pause() : a.play(), $(this).toggleClass("on")
	});

	/*单页显示滑动*/
	var e = $(".slidePage"),
		n = 0,
		i = e.length;
	slide.finSlide = function(a) {
		if (n - a.y == i && $(".btnShare").click(), !(n - a.y < 0 || n - a.y > i - 1)) {
			n -= a.y;
			var o = e.removeClass("out").filter(".in").toggleClass("in out").end().eq(n).addClass("in");
			o.find(".slideMain").addClass("on");
			o.siblings().find(".slideMain").removeClass("on");
			slide.preload(n + 1, 3);
		}
	}

	/*手势事件绑定*/
	document.addEventListener("touchstart", slide);
	document.addEventListener("touchmove", slide);
	document.addEventListener("touchend", slide);
});
var slide = function() {
	var e, n, i, a, o = {
		up: {
			x: 0,
			y: -1,
			dir: "up"
		},
		down: {
			x: 0,
			y: 1,
			dir: "down"
		},
		left: {
			x: -1,
			y: 0,
			dir: "left"
		},
		right: {
			x: 1,
			y: 0,
			dir: "right"
		},
		origin: {
			x: 0,
			y: 0,
			dir: "origin"
		}
	};
	t = function(o) {
		e = i = o.clientX, n = a = o.clientY
	};
	d = function(e) {
		i = e.clientX, a = e.clientY, event.preventDefault()
	};
	r = function(t) {
		var d = i - e,
			r = a - n;
		t(25 > d * d + r * r ? o.origin : Math.abs(d) > Math.abs(r) ? d > 0 ? o.right : o.left : r > 0 ? o.down : o.up)
	};
	c = {};
	l = !1;
	return {
		handleEvent: function(e) {
			if (!(e.targetTouches.length > 1)) switch (e.type) {
				case "touchstart":
					t(e.touches[0]);
					break;
				case "touchmove":
					d(e.touches[0]);
					break;
				case "touchend":
					l || r(this.finSlide)
			}
		},
		finSlide: function() {},
		slideUp: function() {
			this.finSlide(o.up)
		},
		slideDown: function() {
			this.finSlide(o.down)
		},
		slideLeft: function() {
			this.finSlide(o.left)
		},
		slideRight: function() {
			this.finSlide(o.right)
		},
		pages: function() {
			return c
		}(),
		preload: function(e, n) {
			for (var i = {
				load: function() {}
			}, a = 0; n > a; a++)(c["#page" + (100 + e + a + "").substr(-2)] || i).load()
		},
		lock: function() {
			l = !0
		},
		unlock: function() {
			l = !1
		}
	}
}();